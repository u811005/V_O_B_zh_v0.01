// 辞書データ
const dictionaryData = {
  "耕作": {
    description: "村の基本的な食料生産手段。",
    details: [
      "基本生産量 = 10 + 20 * ((耐力/20) * (勤奮/20))",
      "秋: 1.5倍",
      "冬: 0.5倍",
      "冷夏: 0.5倍",
      "豐收: 2.0倍",
      "熟練農夫: 1.3倍",
      "達人農夫: 1.5倍",
      "大地の巫女: 1.5倍"
    ]
  },
  "伐木": {
    description: "村の基本的な建材生産手段。",
    details: [
      "基本生産量 = 10 + 20 * ((耐力/20) * (力量/20))",
      "冷夏: 0.5倍",
      "豐收: 2.0倍",
      "熟練木樵: 1.3倍",
      "達人木樵: 1.5倍"
    ]
  },
  "狩獵": {
    description: "食料を得る手段の一つ。成功判定あり。",
    details: [
      "失敗(20%): 基本値0",
      "成功(60%): 基本値20",
      "大成功(20%): 基本値50",
      "最終生産量 = 基本値 * ((力量/20) * (勇気/20))",
      "冬: 1.2倍",
      "豐收: 2.0倍",
      "月の巫女: 1.5倍",
      "飛行: 1.2倍",
      "熟練狩人: 1.3倍",
      "達人狩人: 1.5倍"
    ]
  },
  "捕魚": {
    description: "食料を得る手段の一つ。成功判定あり。",
    details: [
      "失敗(20%): 基本値0",
      "成功(60%): 基本値20",
      "大成功(20%): 基本値50",
      "最終生産量 = 基本値 * ((耐力/20) * (勇気/20))",
      "豐收: 2.0倍",
      "水中呼吸: 1.5倍",
      "海の知恵: 1.5倍",
      "熟練捕魚師: 1.3倍",
      "達人捕魚師: 1.5倍"
    ]
  },
  "採集": {
    description: "食料と建材を少量得られる手段。",
    details: [
      "食料基本値 = 5 + 10 * ((靈巧/20) * (知力/20))",
      "建材基本値 = 1～3",
      "秋: 1.5倍",
      "豐收: 2.0倍",
      "飛行: 1.2倍",
      "森の知恵: 1.5倍"
    ]
  },
  "豐收": {
    description: "村特性の一つ。",
    details: [
      "全ての生産量が2倍になる",
      "耕作、伐木、狩獵、捕魚、採集に影響"
    ]
  },
  "休養": {
    description: "体力とメンタルを回復する基本的な行動。",
    details: [
      "大成功(30%): 体力+70,メンタル+30",
      "成功(60%): 体力+50,メンタル+20",
      "失敗(10%): 体力+30,メンタル+0",
      "老人: 効果×0.7",
      "中年: 効果×0.9",
      "工作中毒: 体力+30,メンタル-10",
      "尼特: 幸福+20"
    ]
  },
  "休閒": {
    description: "メンタルを回復し、趣味の効果を発動する。",
    details: [
      "基本: メンタル+50",
      "尼特: メンタル+100,幸福+20",
      "趣味効果も発動"
    ]
  },
  "學習": {
    description: "知力と勤奮を上昇させる。",
    details: [
      "体力コスト: 10 * (1-耐力/100)",
      "メンタルコスト: 10 * (1-勤奮/100)",
      "30%で知力上昇",
      "30%で勤奮上昇"
    ]
  },
  "鍛鍊": {
    description: "力量、耐力、勇気を上昇させる。",
    details: [
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 15 * (1-勤奮/100)",
      "40%で力量上昇",
      "30%で耐力上昇",
      "20%で勇気上昇"
    ]
  },
  "看護": {
    description: "最も体力の低い村人を回復させる。",
    details: [
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-道德/100)",
      "回復量 = 20 * (魔力/20) * (道德/20)",
      "5%で魔力上昇",
      "5%で道德上昇"
    ]
  },
  "修女": {
    description: "全村人のメンタルを回復する。",
    details: [
      "体力コスト: 10 * (1-耐力/100)",
      "メンタルコスト: 30 * (1-道德/100)",
      "回復量 = 5 * (魅力/20) * (道德/20)",
      "5%で魅力上昇",
      "5%で道德上昇"
    ]
  },
  "神官": {
    description: "全村人のメンタルを回復する。",
    details: [
      "体力コスト: 10 * (1-耐力/100)",
      "メンタルコスト: 30 * (1-道德/100)",
      "回復量 = 5 * (魅力/20) * (道德/20)",
      "5%で魅力上昇",
      "5%で道德上昇"
    ]
  },
  "交換の奇蹟": {
    description: "2人の肉体を交換する。",
    details: [
      "コスト: 20魔素",
      "村人同士のみ交換可能",
      "精神年齢と精神性別はそのまま"
    ]
  },
  "交換の奇蹟・強": {
    description: "2人の肉体を交換する（村外可）。",
    details: [
      "コスト: 80魔素",
      "訪問者や襲擊者との交換も可能",
      "精神年齢と精神性別はそのまま"
    ]
  },
  "豐收の奇蹟": {
    description: "今月のみ全ての生産量が2倍になる。",
    details: [
      "コスト: 100魔素",
      "村特性に「豐收」が付与される",
      "耕作、伐木、狩獵、捕魚、採集に効果"
    ]
  },
  "嗎哪の奇蹟": {
    description: "食料を得る。",
    details: [
      "コスト: 40魔素",
      "食料+80"
    ]
  },
  "邱比特の奇蹟": {
    description: "2人を強制的に結婚させる。",
    details: [
      "コスト: 80魔素",
      "通常の結婚条件を無視",
      "幸福+50",
      "已婚特性付与"
    ]
  },
  "宴會の奇蹟": {
    description: "全員の状態を回復する。",
    details: [
      "コスト: 人数×15魔素",
      "人数×15資金も必要",
      "全員の体力/メンタル+30",
      "全員の幸福+20"
    ]
  },
  "狂宴の奇蹟": {
    description: "全員の状態を大幅に回復するが道德が下がる。",
    details: [
      "コスト: 人数×30魔素",
      "人数×30資金も必要",
      "全員の体力/メンタル+100",
      "全員の幸福+50",
      "全員の道德70%減少",
      "全員の好色+15"
    ]
  },
  "治癒の奇蹟": {
    description: "1人の状態異常を回復する。",
    details: [
      "コスト: 80魔素",
      "体力/メンタル+50",
      "受傷、疲勞、過勞、飢餓、心累、抑鬱を回復"
    ]
  },
  "戰神の奇蹟": {
    description: "1人に火星の加護を付与する。",
    details: [
      "コスト: 10魔素",
      "3ヶ月継続",
      "力量・耐力・勇気が1.6倍",
      "知力・勤奮・道德が0.2倍"
    ]
  },
  "竈女神の奇蹟": {
    description: "恋人同士を結婚させる。",
    details: [
      "コスト: 60魔素",
      "恋人がいない場合は30魔素返還",
      "幸福+50",
      "已婚特性付与"
    ]
  },
  "常春の奇蹟": {
    description: "村を春に固定する。",
    details: [
      "コスト: 300魔素",
      "村特性を春に固定",
      "夏、秋、冬、冷夏、飛蝗、厳冬、疫病流行を除去"
    ]
  },
  "旅者の奇蹟": {
    description: "ランダムな訪問者を生成する。",
    details: [
      "コスト: 60魔素",
      "訪問者1名を生成",
      "村特性に「訪問者」が付与"
    ]
  },
  "遠行の奇蹟": {
    description: "1人を村から離脱させ魔素を得る。",
    details: [
      "コスト: 20魔素",
      "対象の幸福度分の魔素を獲得",
      "対象は村から離脱"
    ]
  },
  // 身体特性
  "老人": {
    description: "60歳以上の特性。身体能力が大きく低下する。",
    details: [
      "力量: 50%",
      "耐力: 50%",
      "魅力: 50%",
      "休養効果: 70%"
    ]
  },
  "中年": {
    description: "40歳以上の特性。身体能力が低下する。",
    details: [
      "力量: 75%",
      "耐力: 75%",
      "魅力: 75%",
      "休養効果: 90%"
    ]
  },
  "尼特": {
    description: "休養や休閒の効果が高い。",
    details: [
      "休養時: 幸福+20",
      "休閒時: メンタル+100(通常50),幸福+20",
      "サボり時: 体力+40,メンタル+40,幸福+20"
    ]
  },
  "工作中毒": {
    description: "休養が苦手。",
    details: [
      "休養時: 体力+30,メンタル-10",
      "勤奮23以上で30%の確率で付与"
    ]
  },
  "非戦主義": {
    description: "戦闘を好まない平和主義者。",
    details: [
      "道德25以上で50%の確率で付与",
      "襲擊戦闘で不利"
    ]
  },
  "聖女的光輝": {
    description: "高い道德性と清らかさを持つ女性の特性。",
    details: [
      "女性のみ",
      "道德23以上、好色12以下で50%の確率で付与",
      "修女、神官の効果上昇"
    ]
  },
  "細指": {
    description: "手先が靈巧な特性。",
    details: [
      "靈巧22以上、魅力22以上で10%の確率で付与",
      "魔法細工、家政の効果上昇"
    ]
  },
  "怕冷": {
    description: "寒さに弱い特性。",
    details: [
      "力量12以下、耐力12以下で10%の確率で付与",
      "冬季の生産性低下"
    ]
  },
  "大食": {
    description: "食料消費が多い特性。",
    details: [
      "耐力22以上、魅力16以下で10%の確率で付与",
      "食料消費量増加"
    ]
  },
  "小食": {
    description: "食料消費が少ない特性。",
    details: [
      "耐力12以下で10%の確率で付与",
      "食料消費量減少"
    ]
  },
  "清澈的聲": {
    description: "美しい声を持つ特性。",
    details: [
      "女性のみ",
      "魅力25以上で10%の確率で付与",
      "詩人、舞者、修女、神官の効果1.2倍"
    ]
  },
  "嘹亮的聲": {
    description: "力強い声を持つ特性。",
    details: [
      "魅力20以上、勇気20以上、道德20以上で30%の確率で付与",
      "詩人、舞者、修女、神官の効果1.2倍"
    ]
  },
  "酒豪": {
    description: "酒に強い特性。",
    details: [
      "耐力25以上、魅力16以上、好色18以上で10%の確率で付与",
      "宴会、狂宴の効果上昇"
    ]
  },
  "大汗": {
    description: "汗をかきやすい特性。",
    details: [
      "耐力24以上、魅力12以下で20%の確率で付与",
      "夏季の生産性低下"
    ]
  },
  // 精神特性
  "才女": {
    description: "知的で勤奮な女性の特性。",
    details: [
      "女性のみ",
      "知力20以上、勤奮18以上、道德16以上",
      "學習、研究の効果上昇"
    ]
  },
  "才色兼備": {
    description: "知的で美しい女性の特性。",
    details: [
      "女性のみ",
      "知力20以上、魅力22以上",
      "學習、研究、接客の効果上昇"
    ]
  },
  "工作狂": {
    description: "極度の働き者。",
    details: [
      "勤奮24以上",
      "全ての生産作業の効果上昇",
      "休養効果低下"
    ]
  },
  "瘋狂": {
    description: "狂気的な知性を持つ。",
    details: [
      "知力24以上、道德9以下",
      "研究、魔法細工の効果上昇"
    ]
  },
  "豪傑": {
    description: "力と勇気を兼ね備えた者。",
    details: [
      "力量24以上、勇気24以上",
      "戦闘能力大幅上昇",
      "狩獵の効果上昇"
    ]
  },
  "職人精神": {
    description: "物作りに長けている。",
    details: [
      "靈巧20以上、勤奮20以上",
      "家政、魔法細工の効果上昇"
    ]
  },
  // 職業熟練特性
  "熟練農夫": {
    description: "耕作に熟練した特性。",
    details: [
      "耕作の生産量1.3倍"    
    ]
  },
  "達人農夫": {
    description: "耕作の達人としての特性。",
    details: [
      "耕作の生産量1.5倍",
      "熟練農夫から更に経験を積むと獲得"
    ]
  },
  "熟練木樵": {
    description: "伐木に熟練した特性。",
    details: [
      "伐木の生産量1.3倍"
    ]
  },
  "達人木樵": {
    description: "伐木の達人としての特性。",
    details: [
      "伐木の生産量1.5倍",
      "熟練木樵から更に経験を積むと獲得"
    ]
  },
  "熟練狩人": {
    description: "狩獵に熟練した特性。",
    details: [
      "狩獵の生産量1.3倍"
    ]
  },
  "達人狩人": {
    description: "狩獵の達人としての特性。",
    details: [
      "狩獵の生産量1.5倍",
      "熟練狩人から更に経験を積むと獲得"
    ]
  },
  "熟練捕魚師": {
    description: "捕魚に熟練した特性。",
    details: [
      "捕魚の生産量1.3倍"
    ]
  },
  "達人捕魚師": {
    description: "捕魚の達人としての特性。",
    details: [
      "捕魚の生産量1.5倍",
      "熟練捕魚師から更に経験を積むと獲得"
    ]
  },
  // 魔法的特性
  "大地の巫女": {
    description: "大地の力を操る巫女としての特性。",
    details: [
      "女性のみ",
      "耕作の生産量1.5倍"
    ]
  },
  "月の巫女": {
    description: "月の力を操る巫女としての特性。",
    details: [
      "女性のみ",
      "狩獵の生産量1.5倍"
    ]
  },
  "飛行": {
    description: "空を飛ぶ能力を持つ特性。",
    details: [
      "狩獵の生産量1.2倍",
      "採集の生産量1.2倍"
    ]
  },
  "水中呼吸": {
    description: "水中で呼吸できる特性。",
    details: [
      "捕魚の生産量1.5倍"
    ]
  },
  "森の知恵": {
    description: "森での生活に長けた特性。",
    details: [
      "採集の生産量1.5倍"
    ]
  },
  "海の知恵": {
    description: "海での生活に長けた特性。",
    details: [
      "捕魚の生産量1.5倍"
    ]
  },
  "舞者": {
    description: "踊りで村人を癒す女性専用の職業。",
    details: [
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-好色/100)",
      "男性村人の幸福度上昇",
      "回復量 = 10 * (魅力/20) * (好色/20)",
      "5%で魅力上昇",
      "5%で好色上昇"
      
    ]
  },
  "詩人": {
    description: "詩や歌で村人を癒す男性専用の職業。",
    details: [
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-勤奮/100)",
      "女性村人の幸福度上昇",
      "回復量 = 10 * (魅力/20) * (魅力/20)",
      "5%で魅力上昇"
      
    ]
  },
  // 新しい仕事の辞書データを追加
  "兔女郎": {
    description: "精神性別が男性の村人全員の幸福度とメンタルを回復する仕事。女性限定。",
    details: [
      "酒場建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-好色/100)",
      "幸福度上昇量: 6 * (魅力/20) * (好色/20)",
      "メンタル回復量: 6 * (魅力/20) * (好色/20)",
      "1%で魅力上昇",
      "1%で好色上昇"
    ]
  },
  "巫女": {
    description: "魔素を増やす仕事。女性限定。",
    details: [
      "礼拝堂建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-好色/100)",
      "魔素増加量: 10 * (魅力/20) * (魔力/20) * (好色/20)",
      "1%で魅力上昇",
      "1%で好色上昇"
    ]
  },
  "按摩": {
    description: "体力が最も低い村人を回復する仕事。",
    details: [
      "体力コスト: 20 * (1-耐力/100)",
      "男性の場合:",
      "- メンタルコスト: 20 * (1-勤奮/100)",
      "- 回復量: 24 * (力量/20) * (靈巧/20)",
      "- 1%で力量上昇",
      "- 1%で靈巧上昇",
      "女性の場合:",
      "- メンタルコスト: 20 * (1-好色/100)",
      "- 回復量: 24 * (魅力/20) * (好色/20)",
      "- 1%で魅力上昇",
      "- 1%で好色上昇",
      "診療所があれば効果1.2倍"
    ]
  },
  "寫書": {
    description: "資金と技術を増やす仕事。",
    details: [
      "図書館建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-勤奮/100)",
      "資金増加量: 24 * (靈巧/20) * (知力/20)",
      "技術増加量: 24 * (靈巧/20) * (知力/20)",
      "1%で靈巧上昇",
      "1%で知力上昇"
    ]
  },
  "醸造": {
    description: "食料と魔素を増やす仕事。",
    details: [
      "醸造所建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-勤奮/100)",
      "食料増加量: 24 * (魔力/20) * (勤奮/20)",
      "魔素増加量: 5 * (魔力/20) * (勤奮/20)",
      "1%で魔力上昇",
      "1%で勤奮上昇"
    ]
  },
  "錬金術": {
    description: "資金と技術を増やす仕事。",
    details: [
      "錬金工房建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-知力/100)",
      "資金増加量: 24 * (魔力/20) * (知力/20)",
      "技術増加量: 24 * (魔力/20) * (知力/20)",
      "1%で魔力上昇",
      "1%で知力上昇"
    ]
  },
  "紡織": {
    description: "資金を増やす仕事。",
    details: [
      "機織小屋建設で解放",
      "体力コスト: 20 * (1-耐力/100)",
      "メンタルコスト: 20 * (1-勤奮/100)",
      "資金増加量: 30 * (靈巧/20) * (勤奮/20)",
      "1%で靈巧上昇",
      "1%で勤奮上昇"
    ]
  },
  // 建築物の辞書データを追加
  "酒場": {
    description: "娯楽施設。",
    details: [
      "建材: 50",
      "資金: 50",
      "技術: 0",
      "詩人・舞者の効果1.2倍",
      "訪問者の最大人数が2人に",
      "女性限定「兔女郎」仕事解放",
      "規模+20"
    ]
  },
  "礼拝堂": {
    description: "信仰施設。",
    details: [
      "建材: 50",
      "資金: 50",
      "技術: 0",
      "修女・神官の効果1.2倍",
      "女性限定「巫女」仕事解放",
      "規模+30"
    ]
  },
  "診療所": {
    description: "医療施設。",
    details: [
      "建材: 50",
      "資金: 0",
      "技術: 100",
      "看護の効果1.2倍",
      "「按摩」仕事解放",
      "規模+20"
    ]
  },
  "圖書館": {
    description: "教育施設。",
    details: [
      "建材: 50",
      "資金: 50",
      "技術: 100",
      "研究の効果1.2倍",
      "「寫書」仕事解放",
      "規模+30"
    ]
  },
  "醸造所": {
    description: "酒造施設。",
    details: [
      "建材: 50",
      "資金: 100",
      "技術: 300",
      "「醸造」仕事解放",
      "規模+40"
    ]
  },
  "錬金工房": {
    description: "錬金施設。",
    details: [
      "建材: 50",
      "資金: 100",
      "技術: 200",
      "「錬金術」仕事解放",
      "規模+40"
    ]
  },
  "機織小屋": {
    description: "織物施設。",
    details: [
      "建材: 50",
      "資金: 50",
      "技術: 100",
      "「紡織」仕事解放",
      "規模+20"
    ]
  },
  "勧誘": {
    description: "訪問者を村人として勧誘する。",
    details: [
      "成功率: coefficient * (魅力/20) * (知力/20) * 100%",
      "- coefficientは訪問者タイプによる係数:",
      "  - 流民: 0.8",
      "  - 巡礼者: 0.2",
      "  - 冒險者: 0.4",
      "  - 旅者: 0.4",
      "  - 學者: 0.2",
      "  - 観光客: 0.4",
      "  - 行商人: 0.2",
      "村の人口が上限に達している場合は実行不可",
      "成功すると訪問者が村人になる",
      "失敗すると訪問者に「招募失敗」特性が付与"
    ]
  },
  "誘惑": {
    description: "訪問者を魅了して村人として勧誘する。",
    details: [
      "条件:",
      "- 誘惑者の好色が21以上必要",
      "- 誘惑者の肉体性別と訪問者の精神性別が異なる必要あり",
      "成功率: coefficient * (魅力/20) * (好色/20) * 100%",
      "- coefficientは訪問者タイプによる係数:",
      "  - 流民: 0.8",
      "  - 巡礼者: 0.2",
      "  - 冒險者: 0.4",
      "  - 旅者: 0.4",
      "  - 學者: 0.2",
      "  - 観光客: 0.4",
      "  - 行商人: 0.2",
      "村の人口が上限に達している場合は実行不可",
      "成功すると訪問者が村人になる",
      "失敗すると訪問者に「招募失敗」特性が付与"
    ]
  },
  "迎撃": {
    description: "襲擊者との戦闘を行う行動。",
    details: [
      "ダメージ計算:",
      "- 物理ダメージ = ((力量 * 勇気) / 400) * 50 - 相手の耐力",
      "- 魔法ダメージ = ((魔力 * 勇気) / 400) * 25",
      "- 物理と魔法のうち高いほうが適用される",
      "HP0になると戦闘離脱",
      "- 「受傷」特性が付与される"
    ]
  },
  "製作陷阱": {
    description: "襲擊者に対して罠を仕掛ける行動。",
    details: [
      "ダメージ計算:",
      "- ダメージ = (靈巧 * 知力 / 400) * 30",
      "- 敵をランダムに1体選んで攻撃",
      "- 敵のHPが0になれば撃破",
      "製作陷阱は襲擊イベントの最初のフェーズで行われる"
    ]
  },
};

export function searchDictionary() {
  const searchTerm = document.getElementById("dictionarySearch").value.trim();
  const contentDiv = document.getElementById("dictionaryContent");
  
  if (!searchTerm) {
    contentDiv.innerHTML = "<p>キーワードを入力してください</p>";
    return;
  }

  const matches = Object.entries(dictionaryData)
    .filter(([key]) => key.includes(searchTerm));

  if (matches.length === 0) {
    contentDiv.innerHTML = "<p>該当する項目が見つかりません</p>";
    return;
  }

  contentDiv.innerHTML = matches.map(([key, data]) => `
    <div style="margin-bottom: 15px;">
      <h3 style="margin: 0 0 5px 0;">${key}</h3>
      <p style="margin: 0 0 5px 0;">${data.description}</p>
      <ul style="margin: 0; padding-left: 20px;">
        ${data.details.map(detail => `<li>${detail}</li>`).join("")}
      </ul>
    </div>
  `).join("");
}

// グローバルに公開
window.searchDictionary = searchDictionary; 